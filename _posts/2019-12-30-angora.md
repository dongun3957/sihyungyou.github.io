---
layout: post
title: "Angora : Efficient Fuzzing by Principled Search 논문 정리"
tags: [논문, Fuzzing, 캡스톤]
comments: true
---

> Angora Fuzzer  

### Abstract  
Fuzzing 이란 소프트웨어 버그를 찾는데 쓰이는 유용하고 인기있는 기술이다. 현재 쓰이고 있는 많은 최신 fuzzer의 performance는 여전히 갈 길이 멀다. [Symbolic Execution](https://www.fuzzingbook.org/html/SymbolicFuzzer.html)을 사용하면 좋은 입력값을 만들어낼 수 있으나 시간이 오래걸린다는 단점이 있다. 반면 [Random Mutation](https://www.fuzzingbook.org/html/MutationFuzzer.html)은 빠르지만 좋은 입력값을 만드는데 어려움이 있다. Angora Fuzzer는 mutation-based fuzzer로 다른 fuzzer들보다 뛰어난 performance를 갖는다. 이 논문에서는 Angora fuzzer가 어떻게 시간이 오래걸리는 symbolic execution은 사용하지 않으면서 path constraint를 풀어내 branch coverage를 높이는지 네 가지 핵심 기술을 통해 설명한다 : scalable byte-level taint tracking, context-sensitive branch count, search based on gradient descent, input length exploration.  

### Introduction  
Coverage-based fuzzer의 핵심은 어떻게 unexplore branch로 flow하는 입력을 만들어내는가 이다. 위에서 말했듯 symbolic execution은 시간이 오래걸릴뿐더러 다양한 종류의 constraint를 효과적으로 풀어내지는 못한다. 그래서 가장 널리 쓰이고 있는 AFL(American Fuzzy Lop)은 타겟 프로그램을 instrument 한다. Instrumentation이란 어떤 입력이 어떤 새로운 branch를 explore하는지 compile time에 observe 하고 이 입력들을 추후에 mutation하여 coverage를 높이는 방법이다. 하지만 이 과정에서 프로그램의 data flow를 고려하지 않기 때문에 효과적이지 못하다. Angroa는 abstract에 기술된 네 가지 방법을 통해 이런 한계를 극복하고자 한다.  

### Backgorund : AFL  
AFL은 path를 set of branch로 측정한다. 이 때 branch를 표현하는 방법은 conditional statement 전후의 basic block ID를 tuple로 나타내는 것이다. AFL은 매 실행에서 각 conditional statment가 몇 번 실행되는지 기록하는 path trace table과 여러 실행 동안 branch가 몇 번 실행되었는지 구간으로 표현하는 branch coverage table을 갖고있다. 이 두 테이블을 비교함으로써 AFL은 새로운 입력이 새로운 internal state of the program을 trigger 했는지 판단한다 : 만약 path trace table entry에는 있으나 branch coverage table에 없다면 new internal state를 찾은 것이다. branch execution time의 previous run과 current run의 값이 다른 경우에도 그렇다.  

### Context-sensitive branch count  
AFL은 branch를 conditional statment 전후의 basic block ID를 tuple로 나타낸다고 했다. 이는 (l_prev, l_cur)와 같은 형태다. 하지만 이런 표현방식은 context-insensitive 하다. 같은 branch를 실행해도 다른 line으로부터 trigger된 것이라면 이것은 이미 실행한 branch 내에 있을 수 있는 또 다른 internal state를 찾을 수 있는 기회인데 AFL은 이런 상황을 이미 cover 했다고 판단하고 더 이상 시도하지 않을 것이다. 이와 같이 이미 explore한 곳이라도 다른 이유나 상황에 의해서 trigger된 것인지 생각해보는 것이 context-sensitiv한 접근이다. Angora는 branch tuple에 context를 추가하여 이것을 구현한다. (l_prev, l_cur, context)와 같은 형태이다.  

### Byte-level taint tracking  
